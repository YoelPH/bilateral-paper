schema: '2.0'
stages:
  enhance:
    cmd: lyscripts data enhance data/joined.csv data/enhanced.csv
    deps:
    - path: data/joined.csv
      hash: md5
      md5: e25f019d04c64af7ab4b5312ec08f1aa
      size: 900228
    params:
      params.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      hash: md5
      md5: 401e2c666493c55b132110ca80a37522
      size: 1132442
  join:
    cmd: "lyscripts data join  -i data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv
      data/2023-isb-multisite.csv data/2023-clb-multisite.csv data/2023-hvh-oropharynx.csv
      -o data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      hash: md5
      md5: 1b949c74081ac4b6224186ebbb9c90df
      size: 159482
    - path: data/2023-clb-multisite.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: data/2023-hvh-oropharynx.csv
      hash: md5
      md5: a5be2bcb32619f901c48bd1d8a7bae8d
      size: 82567
    - path: data/2023-isb-multisite.csv
      hash: md5
      md5: 6135ac91c08b7518372488fb2e0f9b69
      size: 204322
    outs:
    - path: data/joined.csv
      hash: md5
      md5: e25f019d04c64af7ab4b5312ec08f1aa
      size: 900228
  filter:
    cmd: lyscripts data filter data/enhanced.csv data/filtered.csv --include-subsites
      C01 C09 C10
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 401e2c666493c55b132110ca80a37522
      size: 1132442
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 0c102461cf4e270ac69c9c48e720a289
      size: 659555
  sampling:
    cmd: "lyscripts sample --input data/filtered.csv --params params.yaml --output
      models/midline.hdf5 --history models/midline_history.csv --walkers-per-dim 10
      --check-interval 50 --nsteps 50 --thin 1\n"
    deps:
    - path: data/filtered.csv
      hash: md5
      md5: 0c102461cf4e270ac69c9c48e720a289
      size: 659555
    - path: params.yaml
      hash: md5
      md5: 4f48066a721eb9b928d5e152b46180b6
      size: 1751
    outs:
    - path: models/midline.hdf5
      hash: md5
      md5: f4a1da52954f8c7d090e3561bf22e459
      size: 37361760
    - path: models/midline_history.csv
      hash: md5
      md5: 53a6d54163288cc430685bfa726e1107
      size: 3193
  sampling@contra:
    cmd: "lyscripts sample --input data/reduced.csv --params models/contra/params.yaml
      --output models/contra/samples.hdf5 --history models/contra/history.csv --walkers-per-dim
      16 --check-interval 50 --nsteps 50 --thin 1\n"
    deps:
    - path: data/reduced.csv
      hash: md5
      md5: aa002de073d5623e88aa2a0bedbf3795
      size: 550127
    params:
      models/contra/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: contra
        version: 1
    outs:
    - path: models/contra/history.csv
      hash: md5
      md5: ec68f39f3b63ac89e65cbbf48b19f47a
      size: 2710
    - path: models/contra/samples.hdf5
      hash: md5
      md5: 317859bf60541c607d7468559037fe62
      size: 18116896
  sampling@bilateral:
    cmd: "lyscripts sample --input data/reduced.csv --params models/bilateral/params.yaml
      --output models/bilateral/samples.hdf5 --history models/bilateral/history.csv
      --walkers-per-dim 16 --check-interval 50 --nsteps 50 --thin 1\n"
    deps:
    - path: data/reduced.csv
      hash: md5
      md5: aa002de073d5623e88aa2a0bedbf3795
      size: 550127
    params:
      models/bilateral/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Bilateral.binary
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/bilateral/history.csv
      hash: md5
      md5: 29fab45530fbd154d613192cc316fe5d
      size: 2958
    - path: models/bilateral/samples.hdf5
      hash: md5
      md5: 2441f40762b2b52d562573aecdea8a97
      size: 25166104
  sampling@midline:
    cmd: "lyscripts sample --input data/reduced.csv --params models/midline/params.yaml
      --output models/midline/samples.hdf5 --history models/midline/history.csv --walkers-per-dim
      16 --check-interval 50 --nsteps 50 --thin 1\n"
    deps:
    - path: data/reduced.csv
      hash: md5
      md5: aa002de073d5623e88aa2a0bedbf3795
      size: 550127
    params:
      models/midline/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Midline
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
            use_central: false
            use_midext_evo: true
            use_mixing: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/midline/history.csv
      hash: md5
      md5: e4a35fc4de450911e17d69f8f9fdc171
      size: 3563
    - path: models/midline/samples.hdf5
      hash: md5
      md5: c2b863c6e0fa97c27e76d37ce24a135b
      size: 47047184
  sampling@ipsi:
    cmd: "lyscripts sample --input data/reduced.csv --params models/ipsi/params.yaml
      --output models/ipsi/samples.hdf5 --history models/ipsi/history.csv --walkers-per-dim
      16 --check-interval 50 --nsteps 50 --thin 1\n"
    deps:
    - path: data/reduced.csv
      hash: md5
      md5: aa002de073d5623e88aa2a0bedbf3795
      size: 550127
    params:
      models/ipsi/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: ipsi
        version: 1
    outs:
    - path: models/ipsi/history.csv
      hash: md5
      md5: 8c2c4ff5f67650a91bbcefcaf80de516
      size: 1265
    - path: models/ipsi/samples.hdf5
      hash: md5
      md5: 596efad658826added839dad184253be
      size: 8763376
  reduce:
    cmd: python scripts/reduce.py data/filtered.csv data/reduced.csv
    deps:
    - path: data/filtered.csv
      hash: md5
      md5: 0c102461cf4e270ac69c9c48e720a289
      size: 659555
    - path: scripts/reduce.py
      hash: md5
      md5: 0472e153b1689d42e5b798961ff84dd3
      size: 831
    outs:
    - path: data/reduced.csv
      hash: md5
      md5: aa002de073d5623e88aa2a0bedbf3795
      size: 550127
  precompute-state-dists@ipsi:
    cmd: "lyscripts predict precompute --samples models/ipsi/samples.hdf5 --params
      models/ipsi/params.yaml --state-dists models/ipsi/distributions.hdf5\n"
    deps:
    - path: models/ipsi/samples.hdf5
      hash: md5
      md5: 596efad658826added839dad184253be
      size: 8763376
    params:
      models/ipsi/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: ipsi
        version: 1
    outs:
    - path: models/ipsi/distributions.hdf5
      hash: md5
      md5: 14189a287007c50124d13ba4fec3c18e
      size: 104448
  precompute-state-dists@contra:
    cmd: "lyscripts predict precompute --samples models/contra/samples.hdf5 --params
      models/contra/params.yaml --state-dists models/contra/distributions.hdf5\n"
    deps:
    - path: models/contra/samples.hdf5
      hash: md5
      md5: 317859bf60541c607d7468559037fe62
      size: 18116896
    params:
      models/contra/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: contra
        version: 1
    outs:
    - path: models/contra/distributions.hdf5
      hash: md5
      md5: 7e1fccc1995883f1996efeb17c1d6408
      size: 104448
  precompute-state-dists@bilateral:
    cmd: "lyscripts predict precompute --samples models/bilateral/samples.hdf5 --params
      models/bilateral/params.yaml --state-dists models/bilateral/distributions.hdf5\n"
    deps:
    - path: models/bilateral/samples.hdf5
      hash: md5
      md5: 2441f40762b2b52d562573aecdea8a97
      size: 25166104
    params:
      models/bilateral/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Bilateral.binary
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/bilateral/distributions.hdf5
      hash: md5
      md5: 837c41439bc363a2abca6430a14606ce
      size: 616448
  precompute-state-dists@midline:
    cmd: "lyscripts predict precompute --samples models/midline/samples.hdf5 --params
      models/midline/params.yaml --state-dists models/midline/distributions.hdf5\n"
    deps:
    - path: models/midline/samples.hdf5
      hash: md5
      md5: c2b863c6e0fa97c27e76d37ce24a135b
      size: 47047184
    params:
      models/midline/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Midline
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
            use_central: false
            use_midext_evo: true
            use_mixing: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/midline/distributions.hdf5
      hash: md5
      md5: ce4b6b3bca3a277f9bd865495f665c7b
      size: 1640448
  precompute-early-priors@ipsi:
    cmd: "lyscripts precompute priors --samples models/ipsi/samples.hdf5 --priors
      models/ipsi/early_priors.hdf5 --params models/ipsi/params.yaml --t-stage early\n"
    deps:
    - path: models/ipsi/samples.hdf5
      hash: md5
      md5: 596efad658826added839dad184253be
      size: 8763376
    params:
      models/ipsi/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: ipsi
        version: 1
    outs:
    - path: models/ipsi/early_priors.hdf5
      hash: md5
      md5: 9fd1b4e1cabcafdfc5fee00fa716736e
      size: 108544
  precompute-early-priors@contra:
    cmd: "lyscripts precompute priors --samples models/contra/samples.hdf5 --priors
      models/contra/early_priors.hdf5 --params models/contra/params.yaml --t-stage
      early\n"
    deps:
    - path: models/contra/samples.hdf5
      hash: md5
      md5: 317859bf60541c607d7468559037fe62
      size: 18116896
    params:
      models/contra/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Unilateral.binary
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
          side: contra
        version: 1
    outs:
    - path: models/contra/early_priors.hdf5
      hash: md5
      md5: 97105d12aa086944cc4dd1fd475d291d
      size: 108544
  precompute-early-priors@bilateral:
    cmd: "lyscripts precompute priors --samples models/bilateral/samples.hdf5 --priors
      models/bilateral/early_priors.hdf5 --params models/bilateral/params.yaml --t-stage
      early\n"
    deps:
    - path: models/bilateral/samples.hdf5
      hash: md5
      md5: 2441f40762b2b52d562573aecdea8a97
      size: 25166104
    params:
      models/bilateral/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Bilateral.binary
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/bilateral/early_priors.hdf5
      hash: md5
      md5: 93c1d80d2a170f14a01e48479fd2e8c4
      size: 620544
  precompute-early-priors@midline:
    cmd: "lyscripts precompute priors --samples models/midline/samples.hdf5 --priors
      models/midline/early_priors.hdf5 --params models/midline/params.yaml --t-stage
      early\n"
    deps:
    - path: models/midline/samples.hdf5
      hash: md5
      md5: 171532a98073bb50597dab469dfd7cac
      size: 49046032
    params:
      models/midline/params.yaml:
        graph:
          tumor:
            T:
            - II
            - III
          lnl:
            II:
            - III
            III: []
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
        model:
          class: Midline
          kwargs:
            is_symmetric:
              tumor_spread: false
              lnl_spread: true
            use_central: false
            use_midext_evo: true
            use_mixing: true
          distributions:
            early:
              frozen: binomial
              max_time: 10
              kwargs:
                p: 0.3
            late:
              parametric: binomial
              max_time: 10
          modalities:
          - max_llh
        version: 1
    outs:
    - path: models/midline/early_priors.hdf5
      hash: md5
      md5: d5501815b159f39268aa49c84a030f0a
      size: 1644544
